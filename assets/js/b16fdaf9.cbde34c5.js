"use strict";(self.webpackChunkevantay_com=self.webpackChunkevantay_com||[]).push([[4082],{5954:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var l=t(4848),i=t(8453);const s={title:"GKE Cheatsheet"},r=void 0,c={id:"gcp-gke-cheatsheet",title:"GKE Cheatsheet",description:"Published on December 24, 2020",source:"@site/docs/gcp-gke-cheatsheet.md",sourceDirName:".",slug:"/gcp-gke-cheatsheet",permalink:"/docs/gcp-gke-cheatsheet",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"GKE Cheatsheet"},sidebar:"docs",previous:{title:"Docker Cheatsheet",permalink:"/docs/docker-cheatsheet"},next:{title:"Mininet Setup",permalink:"/docs/mininet-setup"}},o={},d=[{value:"Clusters",id:"clusters",level:2},{value:"Creating a cluster",id:"creating-a-cluster",level:3},{value:"Deleting a cluster",id:"deleting-a-cluster",level:3},{value:"Getting cluster info",id:"getting-cluster-info",level:3},{value:"Deployments",id:"deployments",level:2},{value:"Creating a deployment",id:"creating-a-deployment",level:3},{value:"Deleting a deployment",id:"deleting-a-deployment",level:3},{value:"Updating your deployment",id:"updating-your-deployment",level:3},{value:"Scaling a deployment",id:"scaling-a-deployment",level:3},{value:"Getting deployment info",id:"getting-deployment-info",level:3},{value:"Resources",id:"resources",level:2}];function a(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"Published on December 24, 2020"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.em,{children:["This document was migrated from ",(0,l.jsx)(n.a,{href:"https://digipie.github.io/digidocs/gcp/kubernetes-engine/",children:"DigiDocs"})]})}),"\n",(0,l.jsxs)(n.p,{children:["In this section, you will find my notes on using Kubernetes on Google Cloud Platform's ",(0,l.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine",children:"Kubernetes Engine"})," (GKE). It covers a typical workflow for starting a Kubernetes cluster and deploying an application on it."]}),"\n",(0,l.jsx)(n.h2,{id:"clusters",children:"Clusters"}),"\n",(0,l.jsx)(n.h3,{id:"creating-a-cluster",children:"Creating a cluster"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Typical command:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gcloud container clusters create $C_NAME --zone $ZONE --num-nodes $NUM\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Shorter command:"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gcloud container clusters create $C_NAME\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"With auto-scaling"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gcloud container clusters create $C_NAME --enable-autoscaling --min-nodes $MIN --max-nodes $MAX\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.p,{children:["The default value for ",(0,l.jsx)(n.code,{children:"--num-nodes"})," is ",(0,l.jsx)(n.strong,{children:"3"})]})}),"\n",(0,l.jsxs)(n.admonition,{type:"tip",children:[(0,l.jsx)(n.p,{children:"You can set the default zone for Kubernetes Engine using the following:"}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["For zonal clusters: ",(0,l.jsx)(n.code,{children:"gcloud config set compute/zone $ZONE"})]}),"\n",(0,l.jsxs)(n.li,{children:["For regional clusters: ",(0,l.jsx)(n.code,{children:"gcloud config set compute/region $REGION"})]}),"\n"]})]}),"\n",(0,l.jsx)(n.h3,{id:"deleting-a-cluster",children:"Deleting a cluster"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Typical command"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"gcloud container clusters delete $C_NAME\n"})}),"\n",(0,l.jsx)(n.h3,{id:"getting-cluster-info",children:"Getting cluster info"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Get all pods running in the cluster"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"kubectl get pods\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Get all services running in the cluster"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"kubectl get services\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Get credentials for cluster"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"gcloud container clusters get-credentials $C_NAME\n"})}),"\n",(0,l.jsx)(n.admonition,{title:"Cite",type:"note",children:(0,l.jsx)(n.p,{children:"This command enables switching to a specific cluster, when working with multiple clusters. It can also be used to access a previously created cluster from a new workstation."})}),"\n",(0,l.jsx)(n.h2,{id:"deployments",children:"Deployments"}),"\n",(0,l.jsx)(n.h3,{id:"creating-a-deployment",children:"Creating a deployment"}),"\n",(0,l.jsxs)(n.p,{children:["To create a deployment, you need to have your Docker image prepared beforehand. This image must be built and uploaded to the ",(0,l.jsx)(n.a,{href:"https://cloud.google.com/container-registry",children:"Container Registry"})," before you can deploy it on your GKE cluster."]}),"\n",(0,l.jsx)(n.admonition,{type:"tip",children:(0,l.jsxs)(n.p,{children:["Before you proceed, you need to configure Docker to authenticate to the Container Registry: ",(0,l.jsx)(n.code,{children:"gcloud auth configure-docker"})]})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Build your image:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker build -t gcr.io/$PROJECT_ID/$NAME:$VER ."})]}),"\n",(0,l.jsxs)(n.li,{children:["Verify it was built:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker images"})]}),"\n",(0,l.jsxs)(n.li,{children:["Upload your image to the registry:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker push gcr.io/$PROJECT_ID/$NAME:$VER"})]}),"\n",(0,l.jsxs)(n.li,{children:["Verify it was uploaded:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker run --rm -p $CONT_PORT:$HOST_PORT gcr.io/$PROJECT_ID/$NAME:$VER"})]}),"\n",(0,l.jsxs)(n.li,{children:["Create your deployment:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"kubectl create deployment $D_NAME --image=gcr.io/$PROJECT_ID/$NAME:$VER"})]}),"\n",(0,l.jsxs)(n.li,{children:["Verify it was deployed:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"kubectl get pods"})]}),"\n",(0,l.jsxs)(n.li,{children:["Expose the deployment to the Internet via a Service resource:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"kubectl expose deployment $D_NAME --type=LoadBalancer --port $EXPOSED_PORT --target-port $HOST_PORT"})]}),"\n",(0,l.jsxs)(n.li,{children:["Verify the service is running:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"kubectl get service"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"deleting-a-deployment",children:"Deleting a deployment"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Delete the Service resource:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"kubectl delete service $D_NAME"})]}),"\n",(0,l.jsxs)(n.li,{children:["Delete the cluster:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"gcloud container clusters delete $C_NAME"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"updating-your-deployment",children:"Updating your deployment"}),"\n",(0,l.jsx)(n.p,{children:"To update your deployment with a new Docker image, you have to upload it to the Cloud Registry. Next, you can apply a rolling update of your deployment's Docker image."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Build your new image (remember to update ",(0,l.jsx)(n.code,{children:"$VER"}),"):",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker build -t gcr.io/$PROJECT_ID/$I_NAME:$VER ."})]}),"\n",(0,l.jsxs)(n.li,{children:["Verify it was built:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker images"})]}),"\n",(0,l.jsxs)(n.li,{children:["Upload your image to the registry:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker push gcr.io/$PROJECT_ID/$I_NAME:$VER"})]}),"\n",(0,l.jsxs)(n.li,{children:["Verify it was uploaded:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"docker run --rm -p $CONT_PORT:$HOST_PORT gcr.io/$PROJECT_ID/$I_NAME:$VER"})]}),"\n",(0,l.jsxs)(n.li,{children:["Apply a rolling image update:",(0,l.jsx)(n.br,{}),"\n",(0,l.jsx)(n.code,{children:"kubectl set image deployment/$D_NAME $I_NAME=gcr.io/$PROJECT_ID/$I_NAME:$VER"})]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"scaling-a-deployment",children:"Scaling a deployment"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Typical example"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl scale deployment $D_NAME --replicas $NUM\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"With auto-scaling"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl autoscale deployment $D_NAME --max $MAX --min $MIN --cpu-percent $PERCENT\n"})}),"\n",(0,l.jsx)(n.h3,{id:"getting-deployment-info",children:"Getting deployment info"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Typical example"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl get deployment $D_NAME\n"})}),"\n",(0,l.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://digipie.github.io/digidocs/gcp/kubernetes-engine/",children:"Original copy of this document at DigiDocs"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands",children:"Kubectl Reference Docs"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.google.com/sdk/gcloud/reference/container/clusters/create",children:"Documentation on 'gcloud container clusters create'"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine/docs/how-to/deleting-a-cluster",children:"Documentation on 'gcloud container clusters delete'"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.google.com/sdk/gcloud/reference/container/clusters/get-credentials",children:"Documentation on 'gcloud container clusters get-credentials'"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app",children:"Tutorial on deploying a containerized web application"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.google.com/kubernetes-engine/docs/how-to/scaling-apps#autoscaling-deployments",children:"Documentation on 'kubectl autoscale'"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var l=t(6540);const i={},s=l.createContext(i);function r(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);